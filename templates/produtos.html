
{% extends 'base.html' %}
{% block content %}

<a href="/dashboard" class="btn btn-secondary mb-3">
    ← Voltar
</a>

<!-- Abas Modernas -->
<ul class="nav nav-pills mb-4 justify-content-center" id="produtoTab" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active px-4"
                data-bs-toggle="pill"
                data-bs-target="#novo-produto"
                type="button">
            <i class="bi bi-plus-circle"></i> Novo Produto
        </button>
    </li>

    <li class="nav-item" role="presentation">
        <button class="nav-link px-4"
                data-bs-toggle="pill"
                data-bs-target="#lista-produto"
                type="button">
            <i class="bi bi-list"></i> Produtos Cadastrados
        </button>
    </li>
</ul>

<div class="tab-content">

    <!-- ===================== -->
    <!-- ABA CADASTRO PRODUTO -->
    <!-- ===================== -->
    <div class="tab-pane fade show active" id="novo-produto">

        <div class="card shadow-sm border-0">
            <div class="card-body">

                <h4 class="mb-4">Cadastrar Produto</h4>

                <form method="post">
                    <input class="form-control mb-3"
                           name="descricao"
                           placeholder="Descrição do Produto"
                           required>

                    <input class="form-control mb-3"
                           name="valor"
                           placeholder="Valor Unitário"
                           required>

                    <input class="form-control mb-3"
                           name="estoque_inicial"
                           placeholder="Estoque Inicial"
                           required>

                    <div class="d-grid">
                        <button class="btn btn-success">
                            <i class="bi bi-check-circle"></i> Salvar
                        </button>
                    </div>
                </form>

            </div>
        </div>

    </div>

    <!-- ===================== -->
    <!-- ABA LISTA PRODUTOS -->
    <!-- ===================== -->
    <div class="tab-pane fade" id="lista-produto">

        <div class="card shadow-sm border-0">
            <div class="card-body">

                <h4 class="mb-3">Lista de Produtos</h4>

                <div class="table-responsive">

                    <table class="table table-striped align-middle">
                        <thead class="table-dark">
                            <tr>
                                <th>ID</th>
                                <th>Descrição</th>
                                <th>Valor</th>
                                <th class="d-none d-md-table-cell">Estoque Inicial</th>
                                <th>Estoque Atual</th>
                                <th class="text-center" style="width:120px;">Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for p in produtos %}
                            <tr>
                                <td>{{ p.id }}</td>
                                <td>{{ p.descricao }}</td>
                                <td>
                                    R$ {{ "{:,.2f}".format(p.valor)
                                    .replace(",", "X")
                                    .replace(".", ",")
                                    .replace("X", ".") }}
                                </td>

                                <td class="d-none d-md-table-cell">
                                    {{ p.estoque_inicial }}
                                </td>

                                <td>
                                    {% if p.estoque_atual <= 5 %}
                                        <span class="badge bg-danger">
                                            {{ p.estoque_atual }}
                                        </span>
                                    {% else %}
                                        <span class="badge bg-success">
                                            {{ p.estoque_atual }}
                                        </span>
                                    {% endif %}
                                </td>

                                <td class="text-center">

                                    <a href="/editar_produto/{{ p.id }}"
                                       class="btn btn-sm btn-outline-primary"
                                       title="Editar">
                                        <i class="bi bi-pencil-square"></i>
                                    </a>

                                    <form action="/zerar_estoque/{{ p.id }}"
                                          method="POST"
                                          style="display:inline-block;"
                                          onsubmit="return confirm('Deseja realmente zerar o estoque deste produto?');">

                                        <button type="submit"
                                                class="btn btn-sm btn-outline-danger"
                                                title="Zerar Estoque">
                                            <i class="bi bi-arrow-counterclockwise"></i>
                                        </button>
                                    </form>

                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>

                </div>

            </div>
        </div>

    </div>

</div>

{% endblock %}
